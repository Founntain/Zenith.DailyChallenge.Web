<!-- Profile header-->

@if (dailyData === undefined || dailyData === null){
  <div class="userContainer boldText">
    <h1 style="text-align: center">User <span class="uppercase" style="color: white">{{username}}</span> not found</h1>
    <h3 style="text-align: center; text-decoration: underline; font-weight: normal">Maybe encourage <span class="uppercase">{{username}}</span> to start their ZDC Career today!</h3>
  </div>
}@else{
  <div class="userContainer" style="position: relative; padding: 0">
    <div class="userBanner" [style.backgroundImage]="'url(https://tetr.io/user-content/banners/' + (dailyData.userInfo?.userId) + '.jpg?rv='+ (dailyData.userInfo?.banner) + ')'"></div>

    <div class="flexRow gap userInfoContainer">
      @if (dailyData.userInfo?.avatar !== undefined && dailyData.userInfo?.avatar !== null) {
        <img src="https://tetr.io/user-content/avatars/{{dailyData.userInfo?.userId}}.jpg?rv={{dailyData.userInfo?.avatar}}" class="profileImage">
      }
      <span class="title username textShadow headerText uppercase">{{username}}'s</span><span class="title username textShadow">profile</span>
      <img src="assets/tetrio-img/ranks/{{dailyData.userInfo?.tetrioRank}}.png" class="mod">
    </div>
    <div class="linkContainer userInfoContainer">
        <mat-icon class="icon textShadow" (click)="openTetrioProfile()">double_arrow</mat-icon>
        <span (click)="openTetrioProfile()" class="textShadow uppercase headerText" style="font-size: 18pt">TETR.IO profile</span>
    </div>
  </div>

  <!-- Settings -->
  @if (isSameUser) {
    <div class="userContainer">
      <h2 class="title">Settings</h2>
      <div style="display: inline-flex; justify-items: center; align-items: center;">
        <input type="checkbox" id="autoTrackingSetting" [checked]="isAutoUpdate" (change)="onAutoTrackingChanged($event)">
        <label class="boldText" for="autoTrackingSetting">Enable Auto Tracking?</label>
      </div>
    </div>
  }
  <!-- Daily Adventure & Splits -->
  <div class="userContainer">
    <h2 class="title">ZDC Stats & History</h2>

    <div class="flexColumn scoreContainer stripes">
      <img src="assets/score.png" class="hugeMod"/>
      <span class="scoreDisplay headerText"> {{dailyData.score.toLocaleString()}}</span>
    </div>

    <!-- Daily Stats -->
    <div class="flexColumn">
      <div class="flexContainer">
        <div class="modContainer nomod">
          <div class="stripes"></div>

          <div class="details">
            <p>No Mod</p>
            <p class="altitude highlight">{{dailyData.altitudes.noMod.toLocaleString()}} M</p>
            <p class="completions headerText">{{dailyData.totalChallengesCompleted.toLocaleString()}} challenges completed</p>
          </div>
        </div>
        <div class="modContainer expert">
          <div class="stripes"></div>

          <div class="details">
            <img src="assets/tetrio-img/mods/expert.png" class="bigMod" />
            <p class="altitude highlight">{{dailyData.altitudes.expert.toLocaleString()}} M</p>
            <p class="completions headerText">{{dailyData.masteryCompletions?.expert?.toLocaleString() ?? 0}} masteries completed</p>
          </div>
        </div>
        <div class="modContainer nohold">
          <div class="stripes"></div>

          <div class="details">
            <img src="assets/tetrio-img/mods/nohold.png" class="bigMod" />
            <p class="altitude highlight">{{dailyData.altitudes.noHold.toLocaleString()}} M</p>
            <p class="completions headerText">{{dailyData.masteryCompletions?.noHold?.toLocaleString() ?? 0}} mastery completions</p>
          </div>
        </div>
      </div>

      <div class="flexContainer">
        <div class="modContainer messy">
          <div class="stripes"></div>

          <div class="details">
            <img src="assets/tetrio-img/mods/messy.png" class="bigMod" />
            <p class="altitude highlight">{{dailyData.altitudes.messy.toLocaleString()}} M</p>
            <p class="completions">{{dailyData.masteryCompletions?.messy?.toLocaleString() ?? 0}} mastery completions</p>
          </div>
        </div>

        <div class="modContainer gravity">
          <div class="stripes"></div>

          <div class="details">
            <img src="assets/tetrio-img/mods/gravity.png" class="bigMod" />
            <p class="altitude highlight">{{dailyData.altitudes.gravity.toLocaleString()}} M</p>
            <p class="completions headerText">{{dailyData.masteryCompletions?.gravity?.toLocaleString() ?? 0}} mastery completions</p>
          </div>
        </div>

        <div class="modContainer volatile">
          <div class="stripes"></div>

          <div class="details">
            <img src="assets/tetrio-img/mods/volatile.png" class="bigMod" />
            <p class="altitude highlight">{{dailyData.altitudes.volatile.toLocaleString()}} M</p>
            <p class="completions headerText">{{dailyData.masteryCompletions?.volatile?.toLocaleString() ?? 0}} mastery completions</p>
          </div>
        </div>
      </div>

      <div class="flexContainer">
        <div class="modContainer doublehole">
          <div class="stripes"></div>

          <div class="details">
            <img src="assets/tetrio-img/mods/doublehole.png" class="bigMod" />
            <p class="altitude highlight">{{dailyData.altitudes.doubleHole.toLocaleString()}} M</p>
            <p class="completions headerText">{{dailyData.masteryCompletions?.doubleHole?.toLocaleString() ?? 0}} mastery completions</p>
          </div>
        </div>

        <div class="modContainer invisible">
          <div class="stripes"></div>

          <div class="details">
            <img src="assets/tetrio-img/mods/invisible.png" class="bigMod" />
            <p class="altitude highlight">{{dailyData.altitudes.invisible.toLocaleString()}} M</p>
            <p class="completions headerText">{{dailyData.masteryCompletions?.invisible?.toLocaleString() ?? 0}} mastery completions</p>
          </div>
        </div>

        <div class="modContainer allspin">
          <div class="stripes"></div>

          <div class="details">
            <img src="assets/tetrio-img/mods/allspin.png" class="bigMod" />
            <p class="altitude highlight">{{dailyData.altitudes.allSpin.toLocaleString()}} M</p>
            <p class="completions">{{dailyData.masteryCompletions?.allSpin?.toLocaleString() ?? 0}} mastery completions</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Splits -->
    <div>
      <h2 class="title">Zenith Splits</h2>
      <div class="splitContainer">

        @for (floor of floors; track floor) {
          <div [class]='["split", floor]'>
            <div [class]='["splitBackground", floor, getFloorReachedCss(dailyData.goldSplits[floor])]'></div>
            <div class="splitWrapper">
              <div [class]='["flexStretch", "floor", floor, getFloorReachedCss(dailyData.goldSplits[floor])]'>
                @if (floor === "potg") {
                  <span>platform of the gods</span>
                }@else{
                  <span>{{floor}}</span>
                }
              </div>
              <div class="flexStretch splitItem flexColumn">
                @if (isNotEmptyTime(dailyData.goldSplits[floor])) {
                  <span class="headerText" style="font-size: 1.25rem">Best Time</span>
                }
                <span class="headerText goldTime" title="Fastest time">{{ getSplitText(dailyData.goldSplits[floor]) }}</span>
              </div>
              <div class="flexStretch splitItem flexColumn">
                @if (isNotEmptyTime(dailyData.splitAverages[floor])) {
                  <span class="headerText" style="font-size: 1.25rem">Average Time</span>
                }
                <span class="headerText averageTime" title="Average time">{{ getSplitText(dailyData.splitAverages[floor], true) }}</span>
              </div>
            </div>
          </div>
        }
      </div>
      <div class="linkContainer userInfoContainer">
        <mat-icon class="icon textShadow" (click)="openTetrioProfile()">double_arrow</mat-icon>
        <span [routerLink]="['/user', username, 'splits']" class="textShadow headerText" style="font-size: 18pt">View all Splits</span>
      </div>
    </div>
  </div>

  <!-- Challenges Completed -->
  @if(challengeData !== undefined && challengeData.length > 0){
    <div class="userContainer">
      <h2 class="title">Completed Challenges</h2>
      <div>
        @if (dailyData.challengesCompleted > 10) {
          <mat-paginator class="borderTop"
                         [pageSizeOptions]="[10, 25, 50, 100]"
                         [pageSize]="challengePageSize"
                         [length]="dailyData.challengesCompleted"
                         (page)="onPageChange($event, 0)"
                         aria-label="Select page of runs">
          </mat-paginator>
        }


        <div style="overflow-x: auto">
          <table mat-table [dataSource]="challengeData">
            <ng-container matColumnDef="Date">
              <th mat-header-cell *matHeaderCellDef> Date </th>
              <td mat-cell *matCellDef="let element"> {{element.date}} </td>
            </ng-container>

            <ng-container matColumnDef="Status">
              <th mat-header-cell *matHeaderCellDef> Completion Status </th>
              <td mat-cell *matCellDef="let element">
                <div>
                  <img [class]="getCompletedImage(element.easyCompleted)"    src="assets/clear_easy_2.png" class="mod" />
                  <img [class]="getCompletedImage(element.normalCompleted)"  src="assets/clear_normal_2.png" class="mod" />
                  <img [class]="getCompletedImage(element.hardCompleted)"    src="assets/clear_hard_2.png" class="mod" />
                  <img [class]="getCompletedImage(element.expertCompleted)"  src="assets/clear_expert.png" class="mod" />
                  <img [class]="getCompletedImage(element.reverseCompleted)" src="assets/clear_reverse.png" class="mod" />
                </div>
              </td>
            </ng-container>

            <tr mat-header-row sticky *matHeaderRowDef="challengesColumns" ></tr>
            <tr mat-row *matRowDef="let row; columns: challengesColumns;"></tr>
          </table>
        </div>

        @if (dailyData.challengesCompleted > 10) {
          <mat-paginator class="borderBottom"
                         [pageSizeOptions]="[10, 25, 50, 100]"
                         [pageSize]="challengePageSize"
                         [length]="dailyData.challengesCompleted"
                         (page)="onPageChange($event, 0)"
                         aria-label="Select page of runs">
          </mat-paginator>
        }
        </div>
    </div>
  }

  <!-- Community Contributions-->
  @if (communityContributionData !== undefined && communityContributionData.length > 0) {
    <div class="dailyContainer userContainer">
      <h2 class="title">Community Challenge Contributions</h2>
      @if (communityContributionData[0].totalContributions > challengePageSize) {
        <mat-paginator
                       class="borderTop"
                       [pageSizeOptions]="[10, 25, 50, 100]"
                       [pageSize]="communityChallengePageSize"
                       [length]="communityContributionData[0].totalContributions"
                       (page)="onPageChange($event, 1)"
                       aria-label="Select page of runs">
        </mat-paginator>
      }

      <div style="overflow-x: auto">
        <table mat-table [dataSource]="communityContributionData">
          <ng-container matColumnDef="Date">
            <th mat-header-cell *matHeaderCellDef> Date </th>
            <td mat-cell *matCellDef="let element"> {{element.challenge}} </td>
          </ng-container>

          <ng-container matColumnDef="Contribution">
            <th mat-header-cell *matHeaderCellDef> Contribution </th>
            <td mat-cell *matCellDef="let element">
              {{getCommunityContributionvalue(element.totalAmountContributed, element.conditionType)}}
            </td>
          </ng-container>

          <tr mat-header-row sticky *matHeaderRowDef="communityChallengeColumns" ></tr>
          <tr mat-row *matRowDef="let _; columns: communityChallengeColumns;"></tr>
        </table>
      </div>

      @if (communityContributionData[0].totalContributions > challengePageSize) {
        <mat-paginator
          class="borderBottom"
          [pageSizeOptions]="[10, 25, 50, 100]"
          [pageSize]="communityChallengePageSize"
          [length]="communityContributionData[0].totalContributions"
          (page)="onPageChange($event, 1)"
          aria-label="Select page of runs">
        </mat-paginator>
      }

    </div>
  }

  <!-- Submit Button -->
  @if (isSameUser) {
    <div (click)="submitRuns()" class="submitButton"><a>Submit New Runs</a></div>
  }

  @if (runData !== undefined && runData.length > 0) {
    <div class="runs userContainer">
      <h2 class="title">Recent Runs</h2>

      @if (dailyData.runs > 25){
        <mat-paginator class="borderTop"
                       [pageSizeOptions]="[25, 50, 100, 250]"
                       [pageSize]="runPageSize"
                       [length]="dailyData.runs"
                       (page)="onPageChange($event, 2)"
                       aria-label="Select page of runs">
        </mat-paginator>
      }
      <div style="overflow-x: auto">
        <table mat-table [dataSource]="runData">
          <ng-container matColumnDef="Altitude">
            <th mat-header-cell *matHeaderCellDef> Altitude </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.altitude}} M</td>
          </ng-container>

          <ng-container matColumnDef="APM">
            <th mat-header-cell *matHeaderCellDef> APM </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.apm}}</td>
          </ng-container>

          <ng-container matColumnDef="PPS">
            <th mat-header-cell *matHeaderCellDef> PPS </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.pps}}</td>
          </ng-container>

          <ng-container matColumnDef="VS">
            <th mat-header-cell *matHeaderCellDef> VS </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.vs}}</td>
          </ng-container>

          <ng-container matColumnDef="KOs">
            <th mat-header-cell *matHeaderCellDef> KO's </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.kOs}}</td>
          </ng-container>

          <ng-container matColumnDef="Quads">
            <th mat-header-cell *matHeaderCellDef> Quads </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.quads}}</td>
          </ng-container>

          <ng-container matColumnDef="Spins">
            <th mat-header-cell *matHeaderCellDef> Spins </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.spins}}</td>
          </ng-container>

          <ng-container matColumnDef="AllClears">
            <th mat-header-cell *matHeaderCellDef> PC's </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.allClears}}</td>
          </ng-container>

          <ng-container matColumnDef="Back2Back">
            <th mat-header-cell *matHeaderCellDef> B2B </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]"> {{element.back2Back}}</td>
          </ng-container>

          <ng-container matColumnDef="Mods">
            <th mat-header-cell *matHeaderCellDef> Mods </th>
            <td mat-cell *matCellDef="let element" [ngClass]="[getSpeedrunCompletedClass(element.altitude, element.speedrunCompleted, element.speedrunSeen)]" class="centerText">
              @for (img of getModArray(element.mods); track img){
                <img [src]="getModImage(img)" class="mod" />
              }
            </td>
          </ng-container>

          <tr mat-header-row sticky *matHeaderRowDef="runColumns" ></tr>
          <tr mat-row *matRowDef="let row; columns: runColumns;" ></tr>
        </table>
      </div>

      @if (dailyData.runs > 25){
        <mat-paginator class="borderBottom"
                       [pageSizeOptions]="[25, 50, 100, 250]"
                       [pageSize]="runPageSize"
                       [length]="dailyData.runs"
                       (page)="onPageChange($event, 2)"
                       aria-label="Select page of runs">
        </mat-paginator>
      }
    </div>
  }
}
